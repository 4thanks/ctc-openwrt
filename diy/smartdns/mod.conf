# Add custom settings here.

# set log level
# log-level [level], level=fatal, error, warn, notice, info, debug
log-level debug

# log-size k,m,g
log-size 256k

log-file /var/log/smartdns.log
log-num 5

# List of hosts that supply bogus NX domain results
# bogus-nxdomain [ip/subnet]

# Add custom settings here.
#conf-file /etc/smartdns/adfilter_smartdns.conf
#conf-file /etc/smartdns/chnroute.conf
conf-file /etc/smartdns/CNIPDb.conf
conf-file /etc/smartdns/gfw_ip_list.conf
conf-file /etc/smartdns/whitelist_full-mod.conf
conf-file /etc/smartdns/blacklist_full-mod.conf

#response-mode fastest-ip
cache-file /etc/smartdns/smartdns.cache
dnsmasq-lease-file /tmp/dhcp.leases
cache-persist yes
cache-size 16384
dualstack-ip-selection yes                                                   
dualstack-ip-selection-threshold 50
prefetch-domain yes
serve-expired yes                                                            
serve-expired-ttl 345600
serve-expired-reply-ttl 1
serve-expired-prefetch-time 43200
force-qtype-SOA 65
max-reply-ip-num 3

speed-check-mode tcp:443,tcp:80,ping

bind :5678 -group domestic -no-cache speed-check-mode ping,tcp:80,tcp:443
bind :5689 -group foreign -blacklist-ip  -exclude-default-group dualstack-ip-selection yes dualstack-ip-selection-threshold 30 speed-check-mode tcp:443,tcp:80,ping

##upstream上游
#server 192.168.5.50:5053
server 210.22.70.3
server 114.114.114.114
server 240C::6666
server 2402:4e00::
server-https https://dns.alidns.com/dns-query -tls-host-verify *.alidns.com -host-name *.alidns.com -http-host *.alidns.com
server-https https://doh.pub/dns-query -tls-host-verify *.doh.pub -host-name *.doh.pub -http-host *.doh.pub
server-https https://doh.360.cn -tls-host-verify doh.360.cn -host-name doh.360.cn -http-host doh.360.cn
server 208.67.220.220:5353 -check-edns
server 80.80.81.81 -check-edns
server 185.184.222.222 -check-edns
server 101.102.103.104 -check-edns

#国内-group domestic -exclude-default-group
server 210.22.70.225 -group domestic -exclude-default-group
server 114.114.114.114 -group domestic -exclude-default-group
server-tls dot.pub -tls-host-verify *.dot.pub -host-name *.dot.pub -http-host *.dot.pub -group domestic -exclude-default-group
server-tls dns.alidns.com -tls-host-verify *.alidns.com -host-name *.alidns.com -http-host *.alidns.com -group domestic -exclude-default-group
server-tls dot.360.cn -tls-host-verify doh.360.cn -host-name doh.360.cn -http-host doh.360.cn -group domestic -exclude-default-group

#国外-blacklist-ip -group foreign -exclude-default-group
server 2408:8026:480:112::6666 -blacklist-ip -group foreign -exclude-default-group
server-tls 2400:3200::1 -tls-host-verify *.alidns.com -host-name *.alidns.com -http-host *.alidns.com -blacklist-ip -group foreign -exclude-default-group
server-tls dot.pub -tls-host-verify *.dot.pub -host-name *.dot.pub -http-host *.dot.pub -blacklist-ip -group foreign -exclude-default-group
server-tls dns.alidns.com -tls-host-verify *.alidns.com -host-name *.alidns.com -http-host *.alidns.com -blacklist-ip -group foreign -exclude-default-group
server-tls dns.ipv6dns.com -tls-host-verify dns.ipv6dns.com -host-name dns.ipv6dns.com -http-host dns.ipv6dns.com -blacklist-ip -group foreign -exclude-default-group
server 8.8.8.8 -check-edns -blacklist-ip -group foreign -exclude-default-group
server-tls dns64.dns.google -check-edns -blacklist-ip -group foreign -exclude-default-group
server-tls 2001:4860:4860::8888 -blacklist-ip -group foreign -exclude-default-group
#server-https https://8888.google/dns-query -check-edns

server 80.80.80.80 -check-edns -blacklist-ip -group foreign -exclude-default-group
#server 192.168.5.50:5053 -group foreign -exclude-default-group
#opendns
server-tls 208.67.222.222 -check-edns -blacklist-ip -group foreign -exclude-default-group
server-tls 2620:119:35::35 -check-edns -blacklist-ip -group foreign -exclude-default-group
server-https https://doh.opendns.com/dns-query -blacklist-ip -group foreign -exclude-default-group
server 9.9.9.11 -check-edns -blacklist-ip -group foreign -exclude-default-group
server 101.101.101.101 -check-edns -blacklist-ip -group foreign -group tw -exclude-default-group
server 2001:de4::101 -check-edns -blacklist-ip -group foreign -group tw -exclude-default-group
server-tls 101.101.101.101 -tls-host-verify 101.101.101.101 -host-name 101.101.101.101 -http-host 101.101.101.101 -check-edns -blacklist-ip -group foreign -exclude-default-group
server-tls 1.1.1.1 -check-edns -blacklist-ip -group foreign -exclude-default-group
server-tls 2606:4700:4700::1111 -check-edns -blacklist-ip -group foreign -exclude-default-group

##dns.sb&Hurricane Electric
server 185.222.222.222 -check-edns -blacklist-ip -group foreign -exclude-default-group
server 74.82.42.42 -check-edns -blacklist-ip -group foreign -exclude-default-group
server 2001:470:20::2 -check-edns -blacklist-ip -group foreign -exclude-default-group
server 5.1.66.255 -check-edns -blacklist-ip -group foreign -exclude-default-group

#cnDoH-alidns
#server 223.6.6.6 -group cnDoH-alidns -exclude-default-group
#nameserver /dns.alidns.com/cnDoH-alidns

#cnDoH-DNSPod
server 119.29.29.29 -group cnDoH-DNSPod -exclude-default-group
nameserver /doh.pub/cnDoH-DNSPod
nameserver /dns.pub/cnDoH-DNSPod
nameserver /dot.pub/cnDoH-DNSPod

edns-client-subnet 168.95.1.0/24
edns-client-subnet 2001:b000:168::1/56

server 168.95.1.0 -check-edns -blacklist-ip -group tw -exclude-default-group
server 2001:b000:168::1 -check-edns -blacklist-ip -group tw -exclude-default-group
nameserver /github.com/tw
